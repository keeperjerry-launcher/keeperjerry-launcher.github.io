# Лимитер и ограничения по IP

Данная функция частично разгружает сервер авторизации, защищая его от подбора паролей. 
Функционал был переписан под управление IP адресами. Пока что он работает только после перезагрузки LaunchServer'a.

::: tip Проблемы на "домашнем" сервере с роутерами
У сервиса есть небольшие проблемы с проксированием: `LaunchServer` не умеет определять IP за шлюзом/прокси.
Это свяазно со стандартной сокетной реализацией через Java. В ближайшее время это планируется решить через
библиотеку **Netty** (не точно, т.к. это глобальное изменение архитектуры).

Так что не удивляйтесь, если вы видите подключение от `192.168.0.1` и т.д.
:::

## Настройка лимитера

Рассмотрим пример конфигурации лимитера:
```bash
# Сервис фильтрации запросов и лимиты подключения
authLimit: false; # Включение системы лимита
authLimitConfig: {
    # Основные настройки
    authRateLimit: 5; # Кол-во попыток авторизации
    authRateLimitMilis: 8000; # Пауза после попыток авторизации 8 сек.
    useAllowIp: true; # Включить белый список
    useBlockIp: true; # Включить черный список

    # Сообщения клиентам
    authRejectString: "Превышен лимит авторизаций, подождите некоторое время!";
    authNotWhitelistString: "Вашего IP нет в белом списке!"; # Показывает только при включенном onlyAllowIp
    authBannedString: "Ваш IP заблокирован!"; # Сообщение о блокировке (работает при blockOnConnect: false)
    
    # Дополнительные настройки
    blockOnConnect: true; # Отключает любые подключения к LaunchServer заблокированным IP
    onlyAllowIp: false; # Разрешить подключение только доверенным IP адресам
};
```

Параметр `authLimit` отвечает за работу всей системы. Если отключить данный параметр - дальнейшая настройка окажется бесполезной.
::: code-tabs
@tab Включен
```bash
authLimit: true; # Включение системы лимита
```

@tab Отключен
```bash
authLimit: false; # Включение системы лимита
```
:::

## Файл с адресами
В лаунчере присутствует файл `ListIpConnection.json`, который хранит в себе белый список (allowIp) и черный список (blockIp). Выглядит он так:

```json
{
  "allowIp": [
    "127.0.0.1",
    "172.18.0.1"
  ],
  "blockIp": [
    "1.2.3.4",
    "4.3.2.1"
  ]
}
```

Белый список (allowIp) предназначен для игровых серверов, чтобы не попадать под проверку (authRateLimit) и не ждать окончания лимита. Черный список (blockIp) предназначен для блокировки IP нежелательных пользователей.

## Команды
В новой системе динамической подгрузки были добавлены команды для операций с IP адресами:

```md
# Белый список
allowip add 127.0.0.1 # Добавить IP в Белый список
allowip del 127.0.0.1 # Убрать IP из Белого списка

# Черный список
blockip add 127.0.0.1 # Добавить IP в Черный список
blockip del 127.0.0.1 # Убрать IP из Черного списка
```

::: tip Включи свои мозги
**НЕ НАДО РУКАМИ СТАВИТЬ IP АДРЕСА БЕЗ ПЕРЕЗАГРУЗКИ В `ListIpConnection.json` И ГОВОРИТЬ МНЕ, ЧТО ОНО НЕ РАБОТАЕТ! Уже были такие сверхразумы. Поверь.**
:::

## Нюансы

Параметр `blockOnConnect` позволяет управлять подключением с заблокированными IP адресами: 
если установлено значение `false` - клиенты увидят сообщение о том, что их IP забанен, 
если установлено значение `true` - заблокированные адреса не смогут вовсе подключится к вашему `LaunchServer`, 
просто отклоняя любое соединение с указанными IP. 

::: tip Для чего это вообще нужно?
`blockOnConnect` - очень удобная функция, которая позволяет скрыть существование вашего лаунчера в сети от незнакомых адресов. Если ваш лаунчер является "приватным" - незнакомцы вовосе не смогут понять работает ли ваш сервер или нет. Особенно актуально против ботов сайта [shodan.io](https://www.shodan.io/)
:::

Параметр `onlyAllowIp` позволяет настроить подключение только для IP, которые указанны в белом списке `allowIp`, так что не забудьте включить его!